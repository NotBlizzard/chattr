var socket=io();$(document).ready(function(){window.current_room="lobby",$(document).on("click",".room",function(o){$("#room_tabs>li").removeClass("focus"),$("#"+o.target.id).addClass("focus"),window.current_room=o.target.id,socket.emit("change room",o.target.id)}),$("#message").keypress(function(o){13===o.which&&$("#send").click()}),$(document).on("click",".exit",function(o){$("#"+o.target.id).remove(),socket.emit("unsubscribe",o.target.id)}),$("#change_username").click(function(){var o=prompt("What is your new username?");socket.emit("change username",{nick:o,room:$("#chat").data("room")})}),$("#send").click(function(){var o=$("#message").val();return""===o?!1:(""===$("#chat").data("room")&&socket.emit("no rooms"),$("#message").val(""),void socket.emit("message",{msg:o,room:$("#chat").data("room"),timestamp:moment().format("H:mm:ss")}))})}),socket.on("connect",function(){socket.emit("pick username",prompt("What is your username?"))}),socket.on("join successful",function(o){$("#username").html("<b><p>"+o+"</p></b>")}),socket.on("username error",function(o){socket.emit("pick username",prompt(o))}),socket.on("change room",function(o){$("#messages").html(""),$("#userlist").html(""),$("#chat").data("room",o.room),$("#messages").append(o.msgs),o.users.forEach(function(o){var e=md5(o).substr(0,6);$("#userlist").append('<p style="color:#'+e+';">'+o+"</p>")})}),socket.on("subscribe",function(o){$("#chat").data("room",o),$("#room_tabs").append("lobby"===o?'<li class="room focus" id= "lobby">lobby</li>':'<li class="room" id= "'+o+'">'+o+'<i id="'+o+'" class="exit fa fa-times"></i></li>')}),socket.on("unsubscribe",function(o){$("#chat").data("room")===o&&$("#chat").data("room",null),$("#"+o).remove()}),socket.on("user joined room",function(o){var e="<p id='annoucement'>"+o.nick+" joined</p>";window.current_room.toLowerCase()===o.room.toLowerCase()&&($("#messages").append(e),$("#userlist").html(""),o.users.forEach(function(o){var e=md5(o).substr(0,6);$("#userlist").append('<p style="color:#'+e+';">'+o+"</p>")}))}),socket.on("user left room",function(o){var e="<p id='annoucement'>"+o.nick+" left</p>";$("#messages").append(e),$("#userlist").html(""),o.users.forEach(function(o){var e=md5(o).substr(0,6);$("#userlist").append('<p style="color:#'+e+';">'+o+"</p>")})}),socket.on("user changed name",function(o){var e="<p id='annoucement'>"+o.old+" is now "+o.current+"</p>";$("#messages").append(e),$("#username").html("<p>"+o.current+"</p>"),$("#userlist").html(""),o.users.forEach(function(o){var e=md5(o).substr(0,6);$("#userlist").append('<p style="color:#'+e+';">'+o+"</p>")})}),socket.on("message",function(o){var e=document.getElementById("room");e.scrollTop=e.scrollHeight;var s="<p>["+o.timestamp+'] <span style="color:#'+o.colour+';"><strong>'+o.nick+"</strong></span>: "+o.msg+"</p>";$("#messages").append(s)}),socket.on("message error",function(o){alert(o)});